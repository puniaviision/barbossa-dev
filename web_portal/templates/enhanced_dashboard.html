<!DOCTYPE html>
<html lang="en" class="bg-black">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbossa Enhanced Control Center v2.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { 
            text-shadow: 0 0 2px rgba(0, 255, 0, 0.5);
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Enhanced scanline effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            z-index: 1;
            background-size: 100% 2px;
            pointer-events: none;
            animation: scanline 8s linear infinite;
        }
        
        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }
        
        /* Enhanced terminal effects */
        .terminal-border {
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1), inset 0 0 20px rgba(0, 255, 0, 0.05);
            border: 2px solid rgba(0, 255, 0, 0.3);
        }
        
        .glow-text {
            text-shadow: 0 0 5px currentColor;
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 255, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 0, 0.8); }
        }
        
        .status-critical { color: #ff0000; text-shadow: 0 0 5px #ff0000; }
        .status-warning { color: #ffaa00; text-shadow: 0 0 5px #ffaa00; }
        .status-healthy { color: #00ff00; text-shadow: 0 0 5px #00ff00; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #000;
            border: 1px solid #00ff00;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00ff00;
            border: 1px solid #000;
        }
        
        .chart-container {
            position: relative;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 4px;
        }
        
        .metric-card {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(0, 255, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            border-color: rgba(0, 255, 0, 0.8);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }
        
        .trend-arrow {
            display: inline-block;
            transition: transform 0.3s ease;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 50;
        }
        
        .prediction-alert {
            animation: prediction-pulse 1.5s infinite;
            border-left: 4px solid #ffaa00;
        }
        
        @keyframes prediction-pulse {
            0%, 100% { background-color: rgba(255, 170, 0, 0.1); }
            50% { background-color: rgba(255, 170, 0, 0.2); }
        }
        
        .optimization-highlight {
            background: linear-gradient(90deg, rgba(0, 255, 0, 0.1) 0%, rgba(0, 255, 0, 0.05) 100%);
            border-left: 3px solid #00ff00;
        }
    </style>
</head>
<body class="bg-black text-green-400 min-h-screen relative">
    <!-- Enhanced Header -->
    <header class="sticky top-0 z-40 bg-black border-b border-green-400/30 px-4 py-3">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-bold uppercase tracking-wider glow-text">
                    ‚ñì BARBOSSA ENHANCED v2.3 ‚ñì
                </h1>
                <span class="text-xs px-2 py-1 border border-green-400 rounded" id="enhanced-features-badge">
                    AI-POWERED
                </span>
            </div>
            <div class="flex gap-4 text-xs items-center">
                <span class="px-2 py-1 border border-green-400 pulse-glow" id="status-badge">ENHANCED</span>
                <span class="text-green-300" id="timestamp"></span>
                <button onclick="toggleAutoRefresh()" class="px-2 py-1 border border-green-400 hover:bg-green-400 hover:text-black transition-colors" id="auto-refresh-btn">
                    AUTO: ON
                </button>
            </div>
        </div>
    </header>

    <!-- Enhanced Main Container -->
    <div class="container mx-auto px-4 py-6 relative z-10">
        
        <!-- System Health Overview with Predictions -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
            <div class="lg:col-span-2">
                <div class="terminal-border p-6 rounded-lg">
                    <h2 class="text-lg font-semibold mb-4 glow-text">üîÆ PREDICTIVE HEALTH ANALYSIS</h2>
                    <div id="health-overview" class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span>System Status:</span>
                            <span id="health-status" class="font-bold status-healthy">ANALYZING...</span>
                        </div>
                        <div class="w-full bg-black border border-green-400/30 rounded">
                            <div id="health-progress" class="bg-green-400 h-2 rounded transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <div id="health-predictions" class="space-y-2 mt-4">
                            <!-- Predictions will be populated here -->
                        </div>
                        <div id="auto-recovery-status" class="text-xs text-green-300">
                            Auto-Recovery: <span id="recovery-enabled">ENABLED</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Real-time Performance Metrics -->
            <div class="lg:col-span-2">
                <div class="terminal-border p-6 rounded-lg">
                    <h2 class="text-lg font-semibold mb-4 glow-text">üìä PERFORMANCE ANALYTICS</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="metric-card p-3 rounded">
                            <div class="text-xs text-green-300">CPU EFFICIENCY</div>
                            <div class="text-lg font-bold" id="cpu-efficiency">--</div>
                            <div class="text-xs trend-arrow" id="cpu-trend">‚Üí</div>
                        </div>
                        <div class="metric-card p-3 rounded">
                            <div class="text-xs text-green-300">MEMORY EFFICIENCY</div>
                            <div class="text-lg font-bold" id="memory-efficiency">--</div>
                            <div class="text-xs trend-arrow" id="memory-trend">‚Üí</div>
                        </div>
                        <div class="metric-card p-3 rounded">
                            <div class="text-xs text-green-300">OPTIMIZATION SCORE</div>
                            <div class="text-lg font-bold" id="optimization-score">--</div>
                            <div class="text-xs" id="last-optimization">Never</div>
                        </div>
                        <div class="metric-card p-3 rounded">
                            <div class="text-xs text-green-300">PREDICTIVE ACCURACY</div>
                            <div class="text-lg font-bold" id="prediction-accuracy">--</div>
                            <div class="text-xs" id="predictions-made">0 predictions</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Resource Monitoring with Trends -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="terminal-border p-6 rounded-lg">
                <h3 class="text-md font-semibold mb-4 glow-text">üöÄ CPU ANALYTICS</h3>
                <div class="chart-container">
                    <canvas id="cpu-chart" width="300" height="200"></canvas>
                </div>
                <div class="mt-4 text-xs space-y-1">
                    <div class="flex justify-between">
                        <span>Current:</span>
                        <span id="cpu-current">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Average:</span>
                        <span id="cpu-average">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Trend:</span>
                        <span id="cpu-trend-text">--</span>
                    </div>
                </div>
            </div>
            
            <div class="terminal-border p-6 rounded-lg">
                <h3 class="text-md font-semibold mb-4 glow-text">üíæ MEMORY ANALYTICS</h3>
                <div class="chart-container">
                    <canvas id="memory-chart" width="300" height="200"></canvas>
                </div>
                <div class="mt-4 text-xs space-y-1">
                    <div class="flex justify-between">
                        <span>Current:</span>
                        <span id="memory-current">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Available:</span>
                        <span id="memory-available">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Trend:</span>
                        <span id="memory-trend-text">--</span>
                    </div>
                </div>
            </div>
            
            <div class="terminal-border p-6 rounded-lg">
                <h3 class="text-md font-semibold mb-4 glow-text">üíø DISK ANALYTICS</h3>
                <div class="chart-container">
                    <canvas id="disk-chart" width="300" height="200"></canvas>
                </div>
                <div class="mt-4 text-xs space-y-1">
                    <div class="flex justify-between">
                        <span>Used:</span>
                        <span id="disk-used">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Free:</span>
                        <span id="disk-free">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Optimization:</span>
                        <span id="disk-optimization">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Work Analytics Dashboard -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="terminal-border p-6 rounded-lg">
                <h3 class="text-md font-semibold mb-4 glow-text">ü§ñ INTELLIGENT WORK DISTRIBUTION</h3>
                <div class="chart-container">
                    <canvas id="work-distribution-chart" width="400" height="300"></canvas>
                </div>
                <div class="mt-4 space-y-2 text-xs">
                    <div id="work-recommendations" class="space-y-1">
                        <!-- Work recommendations will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="terminal-border p-6 rounded-lg">
                <h3 class="text-md font-semibold mb-4 glow-text">‚ö° PERFORMANCE TRENDS</h3>
                <div class="chart-container">
                    <canvas id="performance-trend-chart" width="400" height="300"></canvas>
                </div>
                <div class="mt-4 text-xs">
                    <div id="performance-insights" class="space-y-1">
                        <!-- Performance insights will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Resource Optimization Dashboard -->
        <div class="terminal-border p-6 rounded-lg mb-8">
            <h3 class="text-md font-semibold mb-4 glow-text">üõ†Ô∏è SMART RESOURCE OPTIMIZATION</h3>
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                <div class="optimization-highlight p-4 rounded">
                    <div class="text-xs text-green-300">SPACE FREED</div>
                    <div class="text-xl font-bold" id="space-freed">--</div>
                    <div class="text-xs" id="last-cleanup">Last: --</div>
                </div>
                <div class="optimization-highlight p-4 rounded">
                    <div class="text-xs text-green-300">CACHE EFFICIENCY</div>
                    <div class="text-xl font-bold" id="cache-efficiency">--</div>
                    <div class="text-xs" id="cache-hit-rate">Hit rate: --</div>
                </div>
                <div class="optimization-highlight p-4 rounded">
                    <div class="text-xs text-green-300">AUTO OPTIMIZATIONS</div>
                    <div class="text-xl font-bold" id="auto-optimizations">--</div>
                    <div class="text-xs" id="optimization-success-rate">Success: --</div>
                </div>
                <div class="optimization-highlight p-4 rounded">
                    <div class="text-xs text-green-300">SYSTEM SCORE</div>
                    <div class="text-xl font-bold" id="system-score">--</div>
                    <div class="text-xs" id="score-trend">Trend: --</div>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="triggerOptimization()" class="px-4 py-2 border border-green-400 hover:bg-green-400 hover:text-black transition-colors rounded">
                    OPTIMIZE NOW
                </button>
                <button onclick="showOptimizationHistory()" class="ml-2 px-4 py-2 border border-green-400/50 hover:border-green-400 transition-colors rounded">
                    VIEW HISTORY
                </button>
            </div>
        </div>

        <!-- Enhanced Predictive Alerts Section -->
        <div class="terminal-border p-6 rounded-lg mb-8">
            <h3 class="text-md font-semibold mb-4 glow-text">üîÆ PREDICTIVE INTELLIGENCE</h3>
            <div id="predictive-alerts" class="space-y-3">
                <!-- Predictive alerts will be populated here -->
            </div>
            <div class="mt-4">
                <div class="text-xs text-green-300 space-y-1">
                    <div>Prediction Engine: <span id="prediction-engine-status">ACTIVE</span></div>
                    <div>Model Accuracy: <span id="model-accuracy">--</span></div>
                    <div>Last Analysis: <span id="last-analysis">--</span></div>
                </div>
            </div>
        </div>

        <!-- Enhanced System Logs with Intelligent Analysis -->
        <div class="terminal-border p-6 rounded-lg">
            <h3 class="text-md font-semibold mb-4 glow-text">üìú INTELLIGENT LOG ANALYSIS</h3>
            <div class="flex gap-2 mb-4">
                <select id="log-filter" class="bg-black border border-green-400 text-green-400 px-2 py-1 rounded text-xs">
                    <option value="all">All Logs</option>
                    <option value="errors">Errors Only</option>
                    <option value="warnings">Warnings</option>
                    <option value="performance">Performance</option>
                    <option value="predictions">Predictions</option>
                </select>
                <button onclick="analyzeLogs()" class="px-3 py-1 border border-green-400 hover:bg-green-400 hover:text-black transition-colors rounded text-xs">
                    ANALYZE PATTERNS
                </button>
                <button onclick="exportLogs()" class="px-3 py-1 border border-green-400/50 hover:border-green-400 transition-colors rounded text-xs">
                    EXPORT
                </button>
            </div>
            <div id="log-display" class="bg-black border border-green-400/30 rounded p-4 h-64 overflow-y-auto font-mono text-xs">
                <div class="text-green-300">Loading intelligent log analysis...</div>
            </div>
            <div class="mt-4">
                <div id="log-insights" class="text-xs space-y-1">
                    <!-- Log insights will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Modal for Optimization History -->
    <div id="optimization-modal" class="modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="terminal-border bg-black p-6 rounded-lg w-full max-w-4xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold glow-text">üõ†Ô∏è OPTIMIZATION HISTORY</h3>
                    <button onclick="closeModal('optimization-modal')" class="text-green-400 hover:text-green-200 text-xl">&times;</button>
                </div>
                <div id="optimization-history-content" class="space-y-4">
                    <!-- Optimization history will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Dashboard JavaScript with AI-powered features
        let autoRefresh = true;
        let refreshInterval;
        let charts = {};
        let systemData = {
            cpu: [],
            memory: [],
            disk: [],
            timestamps: []
        };
        
        // Initialize enhanced dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            startAutoRefresh();
            updateTimestamp();
            setInterval(updateTimestamp, 1000);
        });
        
        function initCharts() {
            // Enhanced CPU chart with predictive elements
            const cpuCtx = document.getElementById('cpu-chart').getContext('2d');
            charts.cpu = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage',
                        data: [],
                        borderColor: '#00ff00',
                        backgroundColor: 'rgba(0, 255, 0, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Predicted',
                        data: [],
                        borderColor: '#ffaa00',
                        backgroundColor: 'rgba(255, 170, 0, 0.1)',
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(0, 255, 0, 0.2)' },
                            ticks: { color: '#00ff00', font: { size: 10 } }
                        },
                        x: {
                            grid: { color: 'rgba(0, 255, 0, 0.2)' },
                            ticks: { color: '#00ff00', font: { size: 10 } }
                        }
                    }
                }
            });
            
            // Enhanced Memory chart
            const memoryCtx = document.getElementById('memory-chart').getContext('2d');
            charts.memory = new Chart(memoryCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Memory Usage',
                        data: [],
                        borderColor: '#00ff00',
                        backgroundColor: 'rgba(0, 255, 0, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(0, 255, 0, 0.2)' },
                            ticks: { color: '#00ff00', font: { size: 10 } }
                        },
                        x: {
                            grid: { color: 'rgba(0, 255, 0, 0.2)' },
                            ticks: { color: '#00ff00', font: { size: 10 } }
                        }
                    }
                }
            });
            
            // Enhanced Disk usage chart
            const diskCtx = document.getElementById('disk-chart').getContext('2d');
            charts.disk = new Chart(diskCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Used', 'Free'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#ff0000', '#00ff00'],
                        borderColor: ['#ff0000', '#00ff00'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: { color: '#00ff00', font: { size: 10 } }
                        }
                    }
                }
            });
            
            // Work distribution chart
            const workCtx = document.getElementById('work-distribution-chart').getContext('2d');
            charts.workDistribution = new Chart(workCtx, {
                type: 'radar',
                data: {
                    labels: ['Infrastructure', 'Personal Projects', 'Davy Jones', 'Self Improvement'],
                    datasets: [{
                        label: 'Work Distribution',
                        data: [0, 0, 0, 0],
                        borderColor: '#00ff00',
                        backgroundColor: 'rgba(0, 255, 0, 0.2)',
                        pointBackgroundColor: '#00ff00'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        r: {
                            grid: { color: 'rgba(0, 255, 0, 0.2)' },
                            pointLabels: { color: '#00ff00', font: { size: 10 } },
                            ticks: { color: '#00ff00', font: { size: 8 } }
                        }
                    }
                }
            });
            
            // Performance trend chart
            const perfCtx = document.getElementById('performance-trend-chart').getContext('2d');
            charts.performanceTrend = new Chart(perfCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Efficiency Score',
                        data: [],
                        backgroundColor: 'rgba(0, 255, 0, 0.3)',
                        borderColor: '#00ff00',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(0, 255, 0, 0.2)' },
                            ticks: { color: '#00ff00', font: { size: 10 } }
                        },
                        x: {
                            grid: { color: 'rgba(0, 255, 0, 0.2)' },
                            ticks: { color: '#00ff00', font: { size: 10 } }
                        }
                    }
                }
            });
        }
        
        async function fetchEnhancedData() {
            try {
                // Fetch comprehensive system data with enhanced features
                const response = await fetch('/api/v2/system/enhanced-status');
                if (!response.ok) {
                    throw new Error('Failed to fetch enhanced data');
                }
                const data = await response.json();
                updateEnhancedDashboard(data);
            } catch (error) {
                console.error('Error fetching enhanced data:', error);
                // Fallback to simulated data for demo
                updateEnhancedDashboard(generateSimulatedData());
            }
        }
        
        function generateSimulatedData() {
            // Generate realistic simulated data for demo purposes
            const now = new Date();
            return {
                health: {
                    status: 'healthy',
                    cpu_percent: 45 + Math.random() * 20,
                    memory_percent: 60 + Math.random() * 15,
                    disk_percent: 75 + Math.random() * 10,
                    predictions: [
                        {
                            type: 'memory_optimization_opportunity',
                            severity: 'info',
                            estimated_time_minutes: 15,
                            description: 'System cache can be optimized to free 200MB'
                        }
                    ],
                    recommendations: [
                        'System performance is optimal',
                        'Consider running cleanup at next maintenance window'
                    ],
                    auto_recovery_actions: []
                },
                performance: {
                    overall_score: 85 + Math.random() * 10,
                    efficiency_scores: {
                        cpu: 88,
                        memory: 82,
                        disk: 91
                    },
                    trends: {
                        cpu_trend: { trend: 'stable', rate: 0.2 },
                        memory_trend: { trend: 'improving', rate: -1.1 },
                        disk_trend: { trend: 'stable', rate: 0.1 }
                    }
                },
                optimization: {
                    space_freed_mb: 1247.3,
                    last_run: now.toISOString(),
                    cache_hit_rate: 94.2,
                    optimizations_count: 23
                },
                work_tally: {
                    infrastructure: 5,
                    personal_projects: 45,
                    davy_jones: 18,
                    barbossa_self: 3
                }
            };
        }
        
        function updateEnhancedDashboard(data) {
            // Update health status with enhanced visualization
            updateHealthStatus(data.health);
            
            // Update performance metrics
            updatePerformanceMetrics(data.performance);
            
            // Update optimization data
            updateOptimizationData(data.optimization);
            
            // Update charts with new data
            updateCharts(data);
            
            // Update predictive alerts
            updatePredictiveAlerts(data.health.predictions);
            
            // Update recommendations
            updateRecommendations(data.health.recommendations);
        }
        
        function updateHealthStatus(health) {
            const statusElement = document.getElementById('health-status');
            const progressElement = document.getElementById('health-progress');
            
            // Calculate health score
            const cpuScore = Math.max(0, 100 - health.cpu_percent);
            const memoryScore = Math.max(0, 100 - health.memory_percent);
            const diskScore = Math.max(0, 100 - health.disk_percent);
            const overallScore = (cpuScore + memoryScore + diskScore) / 3;
            
            statusElement.textContent = health.status.toUpperCase();
            statusElement.className = `font-bold status-${health.status}`;
            progressElement.style.width = `${overallScore}%`;
            
            // Update auto-recovery status
            document.getElementById('recovery-enabled').textContent = 
                health.auto_recovery_actions.length > 0 ? 'ACTIVE' : 'ENABLED';
        }
        
        function updatePerformanceMetrics(performance) {
            if (!performance) return;
            
            document.getElementById('cpu-efficiency').textContent = 
                performance.efficiency_scores?.cpu ? `${performance.efficiency_scores.cpu}%` : '--';
            document.getElementById('memory-efficiency').textContent = 
                performance.efficiency_scores?.memory ? `${performance.efficiency_scores.memory}%` : '--';
            document.getElementById('optimization-score').textContent = 
                performance.overall_score ? `${Math.round(performance.overall_score)}` : '--';
            
            // Update trend arrows
            updateTrendArrow('cpu-trend', performance.trends?.cpu_trend);
            updateTrendArrow('memory-trend', performance.trends?.memory_trend);
        }
        
        function updateTrendArrow(elementId, trend) {
            const element = document.getElementById(elementId);
            if (!trend || !element) return;
            
            let arrow = '‚Üí';
            let color = '#00ff00';
            
            if (trend.trend === 'increasing') {
                arrow = '‚Üó';
                color = trend.rate > 2 ? '#ff0000' : '#ffaa00';
            } else if (trend.trend === 'decreasing') {
                arrow = '‚Üò';
                color = '#00ff00';
            }
            
            element.textContent = arrow;
            element.style.color = color;
        }
        
        function updateOptimizationData(optimization) {
            if (!optimization) return;
            
            document.getElementById('space-freed').textContent = 
                `${optimization.space_freed_mb.toFixed(1)}MB`;
            document.getElementById('cache-efficiency').textContent = 
                `${optimization.cache_hit_rate.toFixed(1)}%`;
            document.getElementById('auto-optimizations').textContent = 
                optimization.optimizations_count.toString();
            
            const lastRun = new Date(optimization.last_run);
            document.getElementById('last-cleanup').textContent = 
                `Last: ${lastRun.toLocaleTimeString()}`;
        }
        
        function updateCharts(data) {
            const now = new Date().toLocaleTimeString();
            
            // Update CPU chart
            if (charts.cpu && data.health) {
                const cpuData = charts.cpu.data;
                cpuData.labels.push(now);
                cpuData.datasets[0].data.push(data.health.cpu_percent);
                
                if (cpuData.labels.length > 20) {
                    cpuData.labels.shift();
                    cpuData.datasets[0].data.shift();
                }
                
                charts.cpu.update('none');
                
                // Update CPU metrics
                document.getElementById('cpu-current').textContent = `${data.health.cpu_percent.toFixed(1)}%`;
                const avgCpu = cpuData.datasets[0].data.reduce((a, b) => a + b, 0) / cpuData.datasets[0].data.length;
                document.getElementById('cpu-average').textContent = `${avgCpu.toFixed(1)}%`;
                document.getElementById('cpu-trend-text').textContent = 
                    data.performance?.trends?.cpu_trend?.trend || 'stable';
            }
            
            // Update Memory chart
            if (charts.memory && data.health) {
                const memoryData = charts.memory.data;
                memoryData.labels.push(now);
                memoryData.datasets[0].data.push(data.health.memory_percent);
                
                if (memoryData.labels.length > 20) {
                    memoryData.labels.shift();
                    memoryData.datasets[0].data.shift();
                }
                
                charts.memory.update('none');
                
                // Update memory metrics
                document.getElementById('memory-current').textContent = `${data.health.memory_percent.toFixed(1)}%`;
                document.getElementById('memory-available').textContent = `${(100 - data.health.memory_percent).toFixed(1)}%`;
                document.getElementById('memory-trend-text').textContent = 
                    data.performance?.trends?.memory_trend?.trend || 'stable';
            }
            
            // Update Disk chart
            if (charts.disk && data.health) {
                charts.disk.data.datasets[0].data = [data.health.disk_percent, 100 - data.health.disk_percent];
                charts.disk.update('none');
                
                document.getElementById('disk-used').textContent = `${data.health.disk_percent.toFixed(1)}%`;
                document.getElementById('disk-free').textContent = `${(100 - data.health.disk_percent).toFixed(1)}%`;
            }
            
            // Update work distribution chart
            if (charts.workDistribution && data.work_tally) {
                const total = Object.values(data.work_tally).reduce((a, b) => a + b, 0);
                if (total > 0) {
                    const percentages = Object.values(data.work_tally).map(v => (v / total) * 100);
                    charts.workDistribution.data.datasets[0].data = percentages;
                    charts.workDistribution.update('none');
                }
            }
        }
        
        function updatePredictiveAlerts(predictions) {
            const container = document.getElementById('predictive-alerts');
            if (!predictions || predictions.length === 0) {
                container.innerHTML = '<div class="text-green-400 text-sm">üéØ No predictive alerts - system operating optimally</div>';
                return;
            }
            
            container.innerHTML = predictions.map(prediction => `
                <div class="prediction-alert p-3 rounded text-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="font-semibold">${prediction.type.replace(/_/g, ' ').toUpperCase()}</span>
                            <div class="text-xs text-green-300 mt-1">${prediction.description}</div>
                        </div>
                        <span class="text-xs ${prediction.severity === 'warning' ? 'text-yellow-400' : 'text-green-400'}">
                            ${prediction.estimated_time_minutes}min
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        function updateRecommendations(recommendations) {
            const container = document.getElementById('work-recommendations');
            if (!recommendations || recommendations.length === 0) {
                container.innerHTML = '<div class="text-green-400">No specific recommendations</div>';
                return;
            }
            
            container.innerHTML = recommendations.map(rec => `
                <div class="text-green-300">‚Ä¢ ${rec}</div>
            `).join('');
        }
        
        function updateTimestamp() {
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
        }
        
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const btn = document.getElementById('auto-refresh-btn');
            btn.textContent = `AUTO: ${autoRefresh ? 'ON' : 'OFF'}`;
            
            if (autoRefresh) {
                startAutoRefresh();
            } else {
                clearInterval(refreshInterval);
            }
        }
        
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            fetchEnhancedData(); // Initial load
            refreshInterval = setInterval(fetchEnhancedData, 5000); // Refresh every 5 seconds
        }
        
        function triggerOptimization() {
            // Trigger resource optimization
            fetch('/api/v2/optimization/trigger', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    console.log('Optimization triggered:', data);
                    // Refresh data after a delay
                    setTimeout(fetchEnhancedData, 2000);
                })
                .catch(error => console.error('Optimization failed:', error));
        }
        
        function showOptimizationHistory() {
            document.getElementById('optimization-modal').style.display = 'block';
            // Load optimization history
            fetch('/api/v2/optimization/history')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('optimization-history-content');
                    // Populate with history data
                    container.innerHTML = '<div class="text-green-400">Optimization history loaded...</div>';
                })
                .catch(error => console.error('Failed to load history:', error));
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function analyzeLogs() {
            console.log('Analyzing logs with AI...');
            // Implement intelligent log analysis
        }
        
        function exportLogs() {
            console.log('Exporting logs...');
            // Implement log export functionality
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'r':
                        e.preventDefault();
                        fetchEnhancedData();
                        break;
                    case 'o':
                        e.preventDefault();
                        triggerOptimization();
                        break;
                    case 't':
                        e.preventDefault();
                        toggleAutoRefresh();
                        break;
                }
            }
        });
        
        // Close modals on escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });
    </script>
</body>
</html>